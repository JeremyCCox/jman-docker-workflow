# jman-docker-workflow
Reusable workflow for automatically hosting docker containers on a local machine through ssh, Based on [appleboy/ssh-action](https://github.com/appleboy/ssh-action) 
## This workflow assumes the following ###
- You have your own SSH server with Docker, and Docker Compose V2
- Your SSH server is setup to accept a user with ssh keys who has Docker execution Permissions. [Give docker permissions to user](https://docs.docker.com/engine/install/linux-postinstall/)
- Your project is using [Dotenvx (link to quickstart)](https://dotenvx.com/docs/quickstart) and you have uploaded your **ENCRYPTED** .env file to the root of your project directory.
- You have the following [github secrets](https://docs.github.com/en/actions/security-for-github-actions/security-guides/using-secrets-in-github-actions) set up for your repository:
  
| Variable Name  | Description |
| ------------- | ------------- |
| DOTENV_PRIVATE_KEY  | Private key generated by dotenvx (Found in .env.keys)  |
| HOST  | Host IP or Domain Address  |
| KEY  | Content of SSH private key. e.g., raw content of ~/.ssh/id_rsa  |
| PORT  | SSH address port (Default is 22)  |
| USERNAME  | SSH username  |

## Usage
Using the workflow in your own project

#### *.github/workflows/publish-on-release.yml* ####
```yml
name: Publish to remote docker through SSH on push to release branch
on:
  push:
    branches:
      -  'release'
jobs:
  publish-in-docker:
    uses: JeremyCCox/jman-docker-workflow/.github/workflows/main.yml@main
    secrets:
      DOTENV_PRIVATE_KEY: ${{ secrets.DOTENV_PRIVATE_KEY }}
      HOST: ${{ secrets.HOST }}
      USERNAME: ${{ secrets.USERNAME }}
      KEY: ${{ secrets.KEY }}
      PORT: ${{ secrets.PORT }}
```
